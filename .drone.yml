---
kind: pipeline
type: docker
name: default

clone:
  disable: true

steps:
  - name: clone
    image: docker.io/bdebyl/alpine-git
    commands:
      - git clone https://github.com/debyltech/go-snipcart-webhook.git .
      - git checkout $DRONE_COMMIT
      - echo -n "0.1.$DRONE_BUILD_NUMBER,latest" > .tags

  - name: build
    image: docker.io/golang:1.20.3
    commands:
      - CGO_ENABLED=0 go build -tags netgo

  - name: deploy-dev
    image: docker.io/bdebyl/awscli
    environment:
      AWS_DEFAULT_REGION: us-east-1
      AWS_ACCESS_KEY_ID:
        from_secret: aws_access_key_id
      AWS_SECRET_ACCESS_KEY:
        from_secret: aws_secret_access_key
    commands:
      - apk add zip
      - zip go-snipcart-webhook.zip go-snipcart-webhook
      - aws lambda update-function-code --function-name go-snipcart-webhook --zip-file "fileb://go-snipcart-webhook.zip"

trigger:
  branch:
  - master
  event:
  - push
---
kind: signature
hmac: dbec349e5e1a8b87d1de1cb753374461ef11c9a0fcf6045d83cc69e9c1b395cc

...
